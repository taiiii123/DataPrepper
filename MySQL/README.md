# DataPrepper

MySQLデータベースへのテストデータ投入を効率化するExcel VBAツールです。

## 概要

本ツールは、Excelシート上でテストデータを管理し、INSERT文の自動生成やデータベースへの直接登録を行うことができます。<br>
開発・テスト環境でのデータ準備作業を大幅に効率化します。

## 動作要件

- Microsoft Excel（マクロ有効）
- MySQL CLIツール（mysql.exe）がインストールされ、PATHが通っていること
- Windows環境

## シート構成

| シート名 | 説明 |
|---------|------|
| タイトル | ツールのタイトル画面 |
| 変更履歴 | バージョン履歴 |
| DB接続設定 | MySQLへの接続情報を設定 |
| 操作 | メイン操作画面（各種ボタン配置） |
| シナリオ | テストシナリオ管理 |
| 雛形テーブル_入力 (例) | テーブル入力シートの雛形（サンプル） |
| 雛形テーブル_入力_ | テーブル入力シートの雛形（空） |

## 機能一覧

### 1. MySQL CLI 確認
MySQLコマンドラインツールが正しくインストールされているか確認します。

### 2. バックアップ実行
指定したデータベースの現在のデータを `mysqldump` でバックアップします。
- 出力先: `./output/backup/backup_YYYYMMDD.sql`

### 3. SQL ファイル作成
入力シートのデータからINSERT文を含むSQLファイルを自動生成します。
- 出力先: `./output/inputN_テーブル名.sql`
- DELETE文 + INSERT文のセットを生成

### 4. SQL 文確認
生成されるSQL文を新規ブックでプレビュー表示します。実際にファイル出力する前に内容を確認できます。

### 5. データ登録
生成したSQLファイルをMySQLデータベースに直接実行してテストデータを登録します。

### 6. OUTPUTフォルダ確認・表示
出力フォルダ内のSQLファイル一覧を確認、またはエクスプローラーで開きます。

## 使い方

[使い方ガイド](使い方ガイド/USER_GUIDE.md)

## 出力フォルダ構成

```
./output/
├── input1_テーブル名.sql    # Group 1 の SQL ファイル
├── input2_テーブル名.sql    # Group 2 の SQL ファイル
├── ...
├── backup/
│   └── backup_YYYYMMDD.sql  # バックアップファイル
├── conf/
│   └── mysql_config.cnf     # MySQL 接続設定（自動生成、隠しフォルダ）
└── mysql_log.txt            # 実行ログ
```

## 生成されるSQLの形式

```sql
DELETE FROM スキーマ名.テーブル名 WHERE 条件;
INSERT INTO スキーマ名.テーブル名(カラム1, カラム2, ...) VALUES ('値1', '値2', ...);
INSERT INTO スキーマ名.テーブル名(カラム1, カラム2, ...) VALUES ('値1', '値2', ...);
...
```

## バージョン情報

- **バージョン**: 2.0.0
- **最終更新日**: 2025/11/23
- **作成者**: Yamada Taiki

## 注意事項

- データ登録前に必ずバックアップを取得することを推奨します
- パスワードは `mysql_config.cnf` ファイルに一時保存されます（隠しフォルダ内）
- 本番環境への誤登録にご注意ください
- マクロを有効にして使用してください

## トラブルシューティング

### MySQL CLI ツールが見つからない場合
- MySQLがインストールされているか確認
- 環境変数PATHにMySQLのbinフォルダが追加されているか確認

### SQL ファイルが作成されない場合
- 入力シート名が「_入力」で終わっているか確認
- 必須項目（テーブル名、WHERE句）が入力されているか確認
- Group番号とNoが1から開始されているか確認

### データ登録でエラーが発生する場合
- `./output/mysql_log.txt` でエラー内容を確認
- DB接続設定が正しいか確認
- SQL文の構文エラーがないか確認
